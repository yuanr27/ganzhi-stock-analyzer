import streamlit as st
from datetime import datetime, timedelta
from lunardate import LunarDate
import pandas as pd

# ===================== 配置区 =====================
YEAR = 2025  # 限定分析年份
TIAN_GAN = ["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"]
DI_ZHI = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"]

# 2025年完整节气数据（公历日期）
JIEQI_2025 = [
    {'name':'小寒', 'date':'2025-01-05'},
    {'name':'大寒', 'date':'2025-01-20'},
    {'name':'立春', 'date':'2025-02-03'},
    {'name':'雨水', 'date':'2025-02-18'},
    {'name':'惊蛰', 'date':'2025-03-05'},
    {'name':'春分', 'date':'2025-03-20'},
    {'name':'清明', 'date':'2025-04-04'},
    {'name':'谷雨', 'date':'2025-04-20'},
    {'name':'立夏', 'date':'2025-05-05'},
    {'name':'小满', 'date':'2025-05-21'},
    {'name':'芒种', 'date':'2025-06-05'},
    {'name':'夏至', 'date':'2025-06-21'},
    {'name':'小暑', 'date':'2025-07-07'},
    {'name':'大暑', 'date':'2025-07-22'},
    {'name':'立秋', 'date':'2025-08-07'},
    {'name':'处暑', 'date':'2025-08-23'},
    {'name':'白露', 'date':'2025-09-07'},
    {'name':'秋分', 'date':'2025-09-23'},
    {'name':'寒露', 'date':'2025-10-08'},
    {'name':'霜降', 'date':'2025-10-23'},
    {'name':'立冬', 'date':'2025-11-07'},
    {'name':'小雪', 'date':'2025-11-22'},
    {'name':'大雪', 'date':'2025-12-07'},
    {​:​​​:'name''冬至''date''2025-12-22'}
​

# ===================== 核心算法 =====================
​ ​​太阳日期​:
    """精确计算干支（含完整异常处理）"""
    尝试:
        # === 年柱计算 ===
        spring_date = ​​年份，12​​3​.日期（）​​  # 2025年立春
        year = YEAR 如果 solar_date >= spring_date 其他的 YEAR-​
        year_gan = TIAN_GAN​​​4​%10​
        year_zhi = DI_ZHI​​​4​%​​

        # === 月柱计算 ===
        jieqi_dates = ​datetime.strptime​jq​​​​'%Y-%m-%d'​.日期（）​​ 为 jq 在 JIEQI_2025​
        month_idx = ​  # 默认值
        为 i 在 range​len​jieqi_dates​​:
            如果 solar_date < jieqi_dates​i​:
                month_idx = i-​
                打破
        其他的:  # 处理超出最后节气的情况
            month_idx = len​jieqi_dates​-​
            
        month_gan = TIAN_GAN​​​year-4​​%10 * ​ + ​​2​​​%10​
m_zhi = DI_ZHI m_idx//​​​​2 + ​​​​​

        # === 日柱计算 ===
月=月日。从太阳日期开始​太阳_日期。年，solar_date。月，solar_date。天​
天干=天干地支。​​​甘之日//10%10 - %​​​%10​  # 修正日干计算
day_zhi = DI_ZHIlunar。甘之日​%10 -​​ %​​     # 修正日支计算

        返回 ​
            f"{年_gan 年_zhi}{​}​
​f"{month_gan}{month_zhi}，
f"{day_gan}{day_zhi}
        ​
        
    除了例外作为 e:
圣。错误（f"计算错误: {}
返回“错误""错误""错误"

# ===================== 业务逻辑 =====================  
WUXING_WEIGHTS = {
丙':1.5'午':1.3'丁':1.2'巳':1.0，
    '甲':0.8'乙':0.7'寅':0.6'卯':0.5
}

 获取火能（[ganzhi_list:
    """火气能量计算（优化算法）"""
返还回合
        WUXING_WEIGHTS.得到char, 0
在ganzhi_list中用于ganzhi
用于甘孜州的Char
    ​​​​

特别日期 ={
    '2025-01-14'​​: ​: ("📊低开震荡走高"​, "中")​​,
    '2025-01-27'​​: ​: ("📉冲高回落"​, , "高")​​, 
    '2025-02-05'​​: ​: ("🚀跳空缺口不回补"​, , "极高")​​,
    '2025-02-19': : ("🔄阴阳交替震荡""中")
}

# ===================== 用户界面 =====================
def main（）:
​​
    
    和 st.容器（）:
圣。标题(“🔥 2025年干支股市分析系统”)
圣。写("本系统专为分析2025年A股市场设计")
        
        # 日期选择器
最小日期 = datetime（年份，1, 1).日期（）
日期=日期时间（年份，12, 31).日期（）
选定日期 = st。date_input(
            "请选择日期", 
值=最小日期，
最小值=最小日期，
最大值=最大日期
        )
        
        如果 st.按钮(“开始量子分析”，帮助=“点击进行深度计算”):
            和 st.旋转器（'正在连接时空连续体...'）:
                尝试:
                    # 获取干支
精确感知（选定日期）
                    
                    # 计算能量
导入流光灯为stget_fire_energy[（[y，m，d]y，m，d]）
从datetime导入datetime、timedelta
从阴历日期导入阴历日期#结果预测
将熊猫导入为pdstrftime()"%Y-%m-%d"
趋势，风险 = 特殊日期。get()​()​​​​日期字符串,“〰️窄幅整理”​, "低"​​
#=====================配置区=====================
年份=2025#限定分析年份# 显示结果
天_甘 = [“甲”，“乙”，“丙”，“丁”，“戊”，“己”，“庚”，“辛”，“壬”，“癸”】成功（f”“”
                    ### 📅 分析日期：{DI_ZHI = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"]}
                    **🔮 干支组合**  
                    🏛️ 年柱：{# 2025年完整节气数据（公历日期）} | 🌙 月柱：{m} | ☀️ 日柱：{d}  
                    
                    **⚡ 能量分析**  
                    🔥 火气强度：{{“名称”：“大寒”，“日期”：“2025—01—20”}，}/5.0  
                    
                    **📊 走势预测**  
                    📈 {{‘名称’：‘惊蛰’，‘日期’：‘2025—03—05’}，}  
                    
                    **⚠️ 风险提示**  
                    🚨 等级：{{'name':'谷雨'，'date':'2025-04-20'}，}  
                    """)
{‘姓名’：‘小满’，‘日期’：‘2025—05—21’}，
{'名称'：'芒种'，'日期'：'2025—06—05'}，除例外情况如下：
{'名称'：'夏至'，'日期'：'2025—06—21'}，错误（f“系统异常：”)

if{“名称”：“大暑”，“日期”：“2025—07—22”}，"__main__":
{“名称”：“立秋”，“日期”：“2025—08—07”}，main()​
