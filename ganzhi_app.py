import streamlit as st
from datetime import datetime, timedelta
from lunardate import LunarDate
import pandas as pd

# ===================== é…ç½®åŒº =====================
YEAR = 2025  # é™å®šåˆ†æžå¹´ä»½
TIAN_GAN = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"]
DI_ZHI = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"]

# 2025å¹´å®Œæ•´èŠ‚æ°”æ•°æ®ï¼ˆå…¬åŽ†æ—¥æœŸï¼‰
JIEQI_2025 = [
    {'name':'å°å¯’', 'date':'2025-01-05'},
    {'name':'å¤§å¯’', 'date':'2025-01-20'},
    {'name':'ç«‹æ˜¥', 'date':'2025-02-03'},
    {'name':'é›¨æ°´', 'date':'2025-02-18'},
    {'name':'æƒŠè›°', 'date':'2025-03-05'},
    {'name':'æ˜¥åˆ†', 'date':'2025-03-20'},
    {'name':'æ¸…æ˜Ž', 'date':'2025-04-04'},
    {'name':'è°·é›¨', 'date':'2025-04-20'},
    {'name':'ç«‹å¤', 'date':'2025-05-05'},
    {'name':'å°æ»¡', 'date':'2025-05-21'},
    {'name':'èŠ’ç§', 'date':'2025-06-05'},
    {'name':'å¤è‡³', 'date':'2025-06-21'},
    {'name':'å°æš‘', 'date':'2025-07-07'},
    {'name':'å¤§æš‘', 'date':'2025-07-22'},
    {'name':'ç«‹ç§‹', 'date':'2025-08-07'},
    {'name':'å¤„æš‘', 'date':'2025-08-23'},
    {'name':'ç™½éœ²', 'date':'2025-09-07'},
    {'name':'ç§‹åˆ†', 'date':'2025-09-23'},
    {'name':'å¯’éœ²', 'date':'2025-10-08'},
    {'name':'éœœé™', 'date':'2025-10-23'},
    {'name':'ç«‹å†¬', 'date':'2025-11-07'},
    {'name':'å°é›ª', 'date':'2025-11-22'},
    {'name':'å¤§é›ª', 'date':'2025-12-07'},
    {â€‹:â€‹â€‹â€‹:'name''å†¬è‡³''date''2025-12-22'}
â€‹

# ===================== æ ¸å¿ƒç®—æ³• =====================
â€‹ â€‹â€‹å¤ªé˜³æ—¥æœŸâ€‹:
    """ç²¾ç¡®è®¡ç®—å¹²æ”¯ï¼ˆå«å®Œæ•´å¼‚å¸¸å¤„ç†ï¼‰"""
    å°è¯•:
        # === å¹´æŸ±è®¡ç®— ===
        spring_date = â€‹â€‹å¹´ä»½ï¼Œ12â€‹â€‹3â€‹.æ—¥æœŸï¼ˆï¼‰â€‹â€‹  # 2025å¹´ç«‹æ˜¥
        year = YEAR å¦‚æžœ solar_date >= spring_date å…¶ä»–çš„ YEAR-â€‹
        year_gan = TIAN_GANâ€‹â€‹â€‹4â€‹%10â€‹
        year_zhi = DI_ZHIâ€‹â€‹â€‹4â€‹%â€‹â€‹

        # === æœˆæŸ±è®¡ç®— ===
        jieqi_dates = â€‹datetime.strptimeâ€‹jqâ€‹â€‹â€‹â€‹'%Y-%m-%d'â€‹.æ—¥æœŸï¼ˆï¼‰â€‹â€‹ ä¸º jq åœ¨ JIEQI_2025â€‹
        month_idx = â€‹  # é»˜è®¤å€¼
        ä¸º i åœ¨ rangeâ€‹lenâ€‹jieqi_datesâ€‹â€‹:
            å¦‚æžœ solar_date < jieqi_datesâ€‹iâ€‹:
                month_idx = i-â€‹
                æ‰“ç ´
        å…¶ä»–çš„:  # å¤„ç†è¶…å‡ºæœ€åŽèŠ‚æ°”çš„æƒ…å†µ
            month_idx = lenâ€‹jieqi_datesâ€‹-â€‹
           Â 
        month_gan = TIAN_GANâ€‹â€‹â€‹year-4â€‹â€‹%10 * â€‹ + â€‹â€‹2â€‹â€‹â€‹%10â€‹
m_zhi = DI_ZHI m_idx//â€‹â€‹â€‹â€‹2 + â€‹â€‹â€‹â€‹â€‹

        # === æ—¥æŸ±è®¡ç®— ===
æœˆ=æœˆæ—¥ã€‚ä»Žå¤ªé˜³æ—¥æœŸå¼€å§‹â€‹å¤ªé˜³_æ—¥æœŸã€‚å¹´ï¼Œsolar_dateã€‚æœˆï¼Œsolar_dateã€‚å¤©â€‹
å¤©å¹²=å¤©å¹²åœ°æ”¯ã€‚â€‹â€‹â€‹ç”˜ä¹‹æ—¥//10%10 - %â€‹â€‹â€‹%10â€‹  # ä¿®æ­£æ—¥å¹²è®¡ç®—
day_zhi = DI_ZHIlunarã€‚ç”˜ä¹‹æ—¥â€‹%10 -â€‹â€‹ %â€‹â€‹     # ä¿®æ­£æ—¥æ”¯è®¡ç®—

        è¿”å›ž â€‹
            f"{å¹´_gan å¹´_zhi}{â€‹}â€‹
â€‹f"{month_gan}{month_zhi}ï¼Œ
f"{day_gan}{day_zhi}
        â€‹
       Â 
    é™¤äº†ä¾‹å¤–ä½œä¸º e:
åœ£ã€‚é”™è¯¯ï¼ˆf"è®¡ç®—é”™è¯¯: {}
è¿”å›žâ€œé”™è¯¯""é”™è¯¯""é”™è¯¯"

# ===================== ä¸šåŠ¡é€»è¾‘ ===================== Â 
WUXING_WEIGHTS = {
ä¸™':1.5'åˆ':1.3'ä¸':1.2'å·³':1.0ï¼Œ
    'ç”²':0.8'ä¹™':0.7'å¯…':0.6'å¯':0.5
}

 èŽ·å–ç«èƒ½ï¼ˆ[ganzhi_list:
    """ç«æ°”èƒ½é‡è®¡ç®—ï¼ˆä¼˜åŒ–ç®—æ³•ï¼‰"""
è¿”è¿˜å›žåˆ
        WUXING_WEIGHTS.å¾—åˆ°char, 0
åœ¨ganzhi_listä¸­ç”¨äºŽganzhi
ç”¨äºŽç”˜å­œå·žçš„Char
    â€‹â€‹â€‹â€‹

ç‰¹åˆ«æ—¥æœŸ ={
    '2025-01-14'â€‹â€‹: â€‹: ("ðŸ“Šä½Žå¼€éœ‡è¡èµ°é«˜"â€‹, "ä¸­")â€‹â€‹,
    '2025-01-27'â€‹â€‹: â€‹: ("ðŸ“‰å†²é«˜å›žè½"â€‹, , "é«˜")â€‹â€‹,Â 
    '2025-02-05'â€‹â€‹: â€‹: ("ðŸš€è·³ç©ºç¼ºå£ä¸å›žè¡¥"â€‹, , "æžé«˜")â€‹â€‹,
    '2025-02-19': : ("ðŸ”„é˜´é˜³äº¤æ›¿éœ‡è¡""ä¸­")
}

# ===================== ç”¨æˆ·ç•Œé¢ =====================
def mainï¼ˆï¼‰:
â€‹â€‹
   Â 
    å’Œ st.å®¹å™¨ï¼ˆï¼‰:
åœ£ã€‚æ ‡é¢˜(â€œðŸ”¥ 2025å¹´å¹²æ”¯è‚¡å¸‚åˆ†æžç³»ç»Ÿâ€)
åœ£ã€‚å†™("æœ¬ç³»ç»Ÿä¸“ä¸ºåˆ†æž2025å¹´Aè‚¡å¸‚åœºè®¾è®¡")
       Â 
        # æ—¥æœŸé€‰æ‹©å™¨
æœ€å°æ—¥æœŸ = datetimeï¼ˆå¹´ä»½ï¼Œ1, 1).æ—¥æœŸï¼ˆï¼‰
æ—¥æœŸ=æ—¥æœŸæ—¶é—´ï¼ˆå¹´ä»½ï¼Œ12, 31).æ—¥æœŸï¼ˆï¼‰
é€‰å®šæ—¥æœŸ = stã€‚date_input(
            "è¯·é€‰æ‹©æ—¥æœŸ",Â 
å€¼=æœ€å°æ—¥æœŸï¼Œ
æœ€å°å€¼=æœ€å°æ—¥æœŸï¼Œ
æœ€å¤§å€¼=æœ€å¤§æ—¥æœŸ
        )
       Â 
        å¦‚æžœ st.æŒ‰é’®(â€œå¼€å§‹é‡å­åˆ†æžâ€ï¼Œå¸®åŠ©=â€œç‚¹å‡»è¿›è¡Œæ·±åº¦è®¡ç®—â€):
            å’Œ st.æ—‹è½¬å™¨ï¼ˆ'æ­£åœ¨è¿žæŽ¥æ—¶ç©ºè¿žç»­ä½“...'ï¼‰:
                å°è¯•:
                    # èŽ·å–å¹²æ”¯
ç²¾ç¡®æ„ŸçŸ¥ï¼ˆé€‰å®šæ—¥æœŸï¼‰
                   Â 
                    # è®¡ç®—èƒ½é‡
å¯¼å…¥æµå…‰ç¯ä¸ºstget_fire_energy[ï¼ˆ[yï¼Œmï¼Œd]yï¼Œmï¼Œd]ï¼‰
ä»Ždatetimeå¯¼å…¥datetimeã€timedelta
ä»Žé˜´åŽ†æ—¥æœŸå¯¼å…¥é˜´åŽ†æ—¥æœŸ#ç»“æžœé¢„æµ‹
å°†ç†ŠçŒ«å¯¼å…¥ä¸ºpdstrftime()"%Y-%m-%d"
è¶‹åŠ¿ï¼Œé£Žé™© = ç‰¹æ®Šæ—¥æœŸã€‚get()â€‹()â€‹â€‹â€‹â€‹æ—¥æœŸå­—ç¬¦ä¸²,â€œã€°ï¸çª„å¹…æ•´ç†â€â€‹, "ä½Ž"â€‹â€‹
#=====================é…ç½®åŒº=====================
å¹´ä»½=2025#é™å®šåˆ†æžå¹´ä»½# æ˜¾ç¤ºç»“æžœ
å¤©_ç”˜ = [â€œç”²â€ï¼Œâ€œä¹™â€ï¼Œâ€œä¸™â€ï¼Œâ€œä¸â€ï¼Œâ€œæˆŠâ€ï¼Œâ€œå·±â€ï¼Œâ€œåºšâ€ï¼Œâ€œè¾›â€ï¼Œâ€œå£¬â€ï¼Œâ€œç™¸â€ã€‘æˆåŠŸï¼ˆfâ€â€œâ€
                    ### ðŸ“… åˆ†æžæ—¥æœŸï¼š{DI_ZHI = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"]}
                    **ðŸ”® å¹²æ”¯ç»„åˆ** Â 
                    ðŸ›ï¸ å¹´æŸ±ï¼š{# 2025å¹´å®Œæ•´èŠ‚æ°”æ•°æ®ï¼ˆå…¬åŽ†æ—¥æœŸï¼‰} | ðŸŒ™ æœˆæŸ±ï¼š{m} | â˜€ï¸ æ—¥æŸ±ï¼š{d} Â 
                   Â 
                    **âš¡ èƒ½é‡åˆ†æž** Â 
                    ðŸ”¥ ç«æ°”å¼ºåº¦ï¼š{{â€œåç§°â€ï¼šâ€œå¤§å¯’â€ï¼Œâ€œæ—¥æœŸâ€ï¼šâ€œ2025â€”01â€”20â€}ï¼Œ}/5.0 Â 
                   Â 
                    **ðŸ“Š èµ°åŠ¿é¢„æµ‹** Â 
                    ðŸ“ˆ {{â€˜åç§°â€™ï¼šâ€˜æƒŠè›°â€™ï¼Œâ€˜æ—¥æœŸâ€™ï¼šâ€˜2025â€”03â€”05â€™}ï¼Œ} Â 
                   Â 
                    **âš ï¸ é£Žé™©æç¤º** Â 
                    ðŸš¨ ç­‰çº§ï¼š{{'name':'è°·é›¨'ï¼Œ'date':'2025-04-20'}ï¼Œ} Â 
                    """)
{â€˜å§“åâ€™ï¼šâ€˜å°æ»¡â€™ï¼Œâ€˜æ—¥æœŸâ€™ï¼šâ€˜2025â€”05â€”21â€™}ï¼Œ
{'åç§°'ï¼š'èŠ’ç§'ï¼Œ'æ—¥æœŸ'ï¼š'2025â€”06â€”05'}ï¼Œé™¤ä¾‹å¤–æƒ…å†µå¦‚ä¸‹ï¼š
{'åç§°'ï¼š'å¤è‡³'ï¼Œ'æ—¥æœŸ'ï¼š'2025â€”06â€”21'}ï¼Œé”™è¯¯ï¼ˆfâ€œç³»ç»Ÿå¼‚å¸¸ï¼šâ€)

if{â€œåç§°â€ï¼šâ€œå¤§æš‘â€ï¼Œâ€œæ—¥æœŸâ€ï¼šâ€œ2025â€”07â€”22â€}ï¼Œ"__main__":
{â€œåç§°â€ï¼šâ€œç«‹ç§‹â€ï¼Œâ€œæ—¥æœŸâ€ï¼šâ€œ2025â€”08â€”07â€}ï¼Œmain()â€‹
